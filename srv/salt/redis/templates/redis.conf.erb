# Managed by puppet - do not modify
#
# Redis configuration

daemonize yes
pidfile /var/run/redis/redis.pid
<% if scope.lookupvar('port') -%>
port <%= scope.lookupvar('port') %>
<% end -%>
<% if scope.lookupvar('listen') -%>
#bind <%= scope.lookupvar('listen') %>
<% end -%>
<% if scope.lookupvar('ipaddress_eth0') -%>
#bind <%= scope.lookupvar('ipaddress_eth0') %>
<% end -%>
<% if scope.lookupvar('unixsocket') -%>
#unixsocket <%= scope.lookupvar('unixsocket') %>
#unixsocketperm 755
<% end -%>
<% if scope.lookupvar('timeout') -%>
timeout <%= scope.lookupvar('timeout') %>
<% end -%>
<% if scope.lookupvar('redis_loglevel') -%>
loglevel <%= scope.lookupvar('redis_loglevel') %>
<% end -%>
<% if scope.lookupvar('logfile') -%>
logfile <%= scope.lookupvar('logfile') %>
<% end -%>
<% if scope.lookupvar('databases') -%>
databases <%= scope.lookupvar('databases') %>
<% end -%>
<% if scope.lookupvar('tcp_backlog') -%>
tcp-backlog <%= scope.lookupvar('tcp_backlog') %>
<% end -%>

# write to disk config
# if 1 key has changed in 900s, write to disk
# if 10 keys have changed in 300s, write to disk
# if 1000 keys have changed in 60s, write to disk
# Snapshotting
<% if scope.lookupvar('save1') -%>
save <%= scope.lookupvar('save1') %>
<% end -%>
<% if scope.lookupvar('save2') -%>
save <%= scope.lookupvar('save2') %>
<% end -%>
<% if scope.lookupvar('save3') -%>
save <%= scope.lookupvar('save3') %>
<% end -%>
<% if scope.lookupvar('rdbcompression') -%>
rdbcompression <%= scope.lookupvar('rdbcompression') %>
<% end -%>
<% if scope.lookupvar('dbfilename') -%>
dbfilename <%= scope.lookupvar('dbfilename') %>
<% end -%>
<% if scope.lookupvar('rdb_dir') -%>
dir <%= scope.lookupvar('rdb_dir') %>
<% end -%>

# Replication
<% if scope.lookupvar('masterip') -%>
#slaveof <%= scope.lookupvar('masterip') %> <%= scope.lookupvar('masterport') %>
<% if scope.lookupvar('masterauth') -%>
#masterauth <%= scope.lookupvar('masterauth') %>
<% end -%>
<% if scope.lookupvar('slave_serve_stale_data') -%>
#slave-serve-stale-data <%= scope.lookupvar('slave_serve_stale_data') %>
<% end -%>
<% if scope.lookupvar('repl_ping_slave_period') -%>
#repl-ping-slave-period <%= scope.lookupvar('repl_ping_slave_period') %>
<% end -%>
<% if scope.lookupvar('repl_timeout') -%>
#repl-timeout <%= scope.lookupvar('repl_timeout') %>
<% end -%>
<% end -%>

# Security
<% if scope.lookupvar('requirepass') -%>
#requirepass <%= scope.lookupvar('requirepass') %>
<% end -%>
<% if scope.lookupvar('command_config') -%>
rename-command CONFIG <%= scope.lookupvar('command_config') %>
<% end -%>
<% if scope.lookupvar('command_flushall') -%>
rename-command FLUSHALL <%= scope.lookupvar('command_flushall') %>
<% end -%>
<% if scope.lookupvar('command_flushdb') -%>
rename-command FLUSHDB <%= scope.lookupvar('command_flushdb') %>
<% end -%>

#Limits
<% if scope.lookupvar('maxclients') -%>
maxclients <%= scope.lookupvar('maxclients') %>
<% end -%>
<% if scope.lookupvar('maxmemory') -%>
maxmemory <%= scope.lookupvar('maxmemory') %>
<% end -%>
<% if scope.lookupvar('maxmemory_policy') -%>
#maxmemory-policy <%= scope.lookupvar('maxmemory_policy') %>
<% end -%>

# Append only mode
<% if scope.lookupvar('appendonly') -%>
appendonly <%= scope.lookupvar('appendonly') %>
<% end -%>
<% if scope.lookupvar('appendfsync') -%>
appendfsync <%= scope.lookupvar('appendfsync') %>
<% end -%>
<% if scope.lookupvar('no_appendfsync_on_rewrite') -%>
no-appendfsync-on-rewrite <%= scope.lookupvar('no_appendfsync_on_rewrite') %>
<% end -%>
<% if scope.lookupvar('auto_aof_rewrite_percentage') -%>
auto-aof-rewrite-percentage <%= scope.lookupvar('auto_aof_rewrite_percentage') %>
<% end -%>
<% if scope.lookupvar('auto_aof_rewrite_min_size') -%>
auto-aof-rewrite-min-size <%= scope.lookupvar('auto_aof_rewrite_min_size') %>
<% end -%>

# Slow log
<% if scope.lookupvar('slowlog_log_slower_than') -%>
slowlog-log-slower-than <%= scope.lookupvar('slowlog_log_slower_than') %>
<% end -%>

<% if scope.lookupvar('slowlog_max_len') -%>
slowlog-max-len <%= scope.lookupvar('slowlog_max_len') %>
<% end -%>

# Advanced Config
<% if scope.lookupvar('list_max_ziplist_entries') -%>
list-max-ziplist-entries <%= scope.lookupvar('list_max_ziplist_entries') %>
<% end -%>
<% if scope.lookupvar('list_max_ziplist_value') -%>
list-max-ziplist-value <%= scope.lookupvar('list_max_ziplist_value') %>
<% end -%>
<% if scope.lookupvar('set_max_intset_entries') -%>
set-max-intset-entries <%= scope.lookupvar('set_max_intset_entries') %>
<% end -%>
<% if scope.lookupvar('zset_max_ziplist_entries') -%>
zset-max-ziplist-entries <%= scope.lookupvar('zset_max_ziplist_entries') %>
<% end -%>
<% if scope.lookupvar('zset_max_ziplist_value') -%>
zset-max-ziplist-value <%= scope.lookupvar('zset_max_ziplist_value') %>
<% end -%>
<% if scope.lookupvar('activerehashing') -%>
activerehashing <%= scope.lookupvar('activerehashing') %>
<% end -%>